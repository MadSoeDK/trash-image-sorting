stages:
  preprocess_data:
    cmd: python -m trashsorting.data data --fraction ${data.fraction} --seed ${data.seed}
    deps:
      - src/trashsorting/data.py
    params:
      - data.fraction
      - data.seed
    outs:
      - data/processed/all_images.pt
      - data/processed/all_labels.pt
      - data/processed/all_metadata.pt

  train:
    cmd: python -m trashsorting.train
    deps:
      - src/trashsorting/train.py
      - src/trashsorting/model.py
      - data/processed/all_images.pt
      - data/processed/all_labels.pt
      - data/processed/all_metadata.pt
    params:
      - data.fraction
      - data.seed
      - train.learning_rate
      - train.batch_size
      - train.epochs
      - train.model_name
      - train.optimizer
    outs:
      - models/model.pth
#    metrics:
#      - reports/metrics.json:
#          cache: false
#    plots:
#      - reports/training_history.json:
#          cache: false
#          x: epoch
#          y: loss

  evaluate:
    cmd: python -m trashsorting.evaluate
    deps:
      - src/trashsorting/evaluate.py
      - src/trashsorting/model.py
      - models/model.pth
      - data/processed/all_images.pt
      - data/processed/all_labels.pt
      - data/processed/all_metadata.pt
    params:
      - data.fraction
      - evaluate.checkpoint_path
      - evaluate.batch_size
      - evaluate.num_workers
    metrics:
      - reports/eval_metrics.json:
          cache: false

